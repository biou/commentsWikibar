"use strict";function addListener(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)}function removeListener(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent("on"+e,n)}function jsToolBar(t){if(document.createElement&&t&&(void 0!==document.selection||void 0!==t.setSelectionRange)){this.textarea=t,this.editor=document.createElement("div"),this.editor.className="jstEditor",this.textarea.parentNode.insertBefore(this.editor,this.textarea),this.editor.appendChild(this.textarea),this.toolbar=document.createElement("div"),this.toolbar.className="jstElements",this.toolbar.setAttribute("role","toolbar"),this.toolbar.setAttribute("aria-label",this.label),this.toolbar.setAttribute("aria-controls","c_content"),this.editor.parentNode.insertBefore(this.toolbar,this.editor),this.handle=document.createElement("div"),this.handle.className="jstHandle";var e=this.resizeDragStart,n=this;addListener(this.handle,"mousedown",(function(t){e.call(n,t)})),addListener(window,"unload",(function(){n.handle.parentNode.removeChild(n.handle),delete n.handle})),this.editor.parentNode.insertBefore(this.handle,this.editor.nextSibling),this.context=null,this.toolNodes={}}}function jsButton(t,e,n,o){this.title=t||null,this.fn=e||function(){},this.scope=n||null,this.className=o||null}function jsSpace(t){this.id=t||null,this.width=null}function jsCombo(t,e,n,o,s){this.title=t||null,this.options=e||null,this.scope=n||null,this.fn=o||function(){},this.className=s||null}jsButton.prototype.draw=function(){if(!this.scope)return null;var t=document.createElement("span");t.className="jsBtnContainer";var e=document.createElement("button");t.appendChild(e),e.setAttribute("type","button"),this.className&&(e.className=this.className);var n=document.createElement("div");if(n.setAttribute("id",e.className+"label"),n.setAttribute("role","tooltip"),n.className="sr-only",e.setAttribute("aria-labelledby",e.className+"label"),n.appendChild(document.createTextNode(this.title)),t.appendChild(n),null!=this.icon&&(e.style.backgroundImage='url(" + this.icon + ")'),addListener(e,"keydown",jsButton.prototype.keyDown),addListener(e,"focus",jsButton.prototype.focus),addListener(e,"blur",jsButton.prototype.blur),addListener(e,"mouseover",jsButton.prototype.mouseOver),addListener(e,"mouseleave",jsButton.prototype.mouseLeave),"function"==typeof this.fn){var o=this;e.onclick=function(){try{o.fn.apply(o.scope,arguments)}catch(t){}return!1}}return t},jsButton.prototype.keyDown=function(t){var e=!1;switch(t.keyCode){case 13:case 32:break;case 39:document.commentTb.moveFocus(this,"next"),e=!0;break;case 37:document.commentTb.moveFocus(this,"previous"),e=!0;break;case 36:document.commentTb.setFocus(document.commentTb.firstItem),e=!0;break;case 35:document.commentTb.setFocus(document.commentTb.lastItem),e=!0;break;case 38:document.commentTb.moveFocus(this,"previous"),e=!0;break;case 40:document.commentTb.moveFocus(this,"next"),e=!0;break;case 27:document.commentTb.hideAllTooltips(),e=!0}e&&(t.stopPropagation(),t.preventDefault())},jsButton.prototype.blur=function(t){document.getElementById(t.target.className+"label").classList.add("sr-only"),document.querySelector(".jstElements").classList.remove("focus")},jsButton.prototype.focus=function(t){document.commentTb.hideAllTooltips(),document.getElementById(t.target.className+"label").classList.remove("sr-only"),document.querySelector(".jstElements").classList.add("focus")},jsButton.prototype.mouseLeave=function(t){t.target.classList.remove("hovered"),setTimeout((function(){t.target.classList.contains("hovered")||document.getElementById(t.target.className+"label").classList.add("sr-only")}),800)},jsButton.prototype.mouseOver=function(t){document.commentTb.hideAllTooltips(),document.getElementById(t.target.className+"label").classList.remove("sr-only"),t.target.classList.add("hovered")},jsSpace.prototype.draw=function(){var t=document.createElement("span");return this.id&&(t.id=this.id),t.appendChild(document.createTextNode(String.fromCharCode(160))),t.className="jstSpacer",this.width&&(t.style.marginRight=this.width+"px"),t},jsCombo.prototype.draw=function(){if(!this.scope||!this.options)return null;var t=document.createElement("select");for(var e in this.className&&(t.className=this.className),t.title=this.title,this.options){var n=document.createElement("option");n.value=e,n.appendChild(document.createTextNode(this.options[e])),t.appendChild(n)}var o=this;return t.onchange=function(){try{o.fn.call(o.scope,this.value)}catch(t){window.alert(t)}return!1},t},jsToolBar.prototype={base_url:"",mode:"wiki",elements:{},getMode:function(){return this.mode},setMode:function(t){this.mode=t||"wiki"},switchMode:function(t){t=t||"wiki",this.draw(t)},button:function(t){var e=this.elements[t];if("function"!=typeof e.fn[this.mode])return null;var n=new jsButton(e.title,e.fn[this.mode],this,"jstb_"+t);return null!=e.icon&&(n.icon=e.icon),n},space:function(t){var e=new jsSpace(t);return void 0!==this.elements[t].width&&(e.width=this.elements[t].width),e},combo:function(t){var e=this.elements[t],n=e[this.mode].list.length;if("function"!=typeof e[this.mode].fn||0==n)return null;for(var o={},s=0;s<n;s++){var i=e[this.mode].list[s];o[i]=e.options[i]}return new jsCombo(e.title,o,this,e[this.mode].fn)},draw:function(t){for(this.setMode(t);this.toolbar.hasChildNodes();)this.toolbar.removeChild(this.toolbar.firstChild);var e,n,o;for(var s in this.toolNodes={},this.elements){null==(e=this.elements[s]).type||""==e.type||null!=e.disabled&&e.disabled||null!=e.context&&null!=e.context&&e.context!=this.context||"function"!=typeof this[e.type]||((n=this[e.type](s))&&(o=n.draw()),o&&(this.toolNodes[s]=o,this.toolbar.appendChild(o)))}this.firstItem=document.querySelector(".jstElements .jsBtnContainer:first-child button"),this.lastItem=document.querySelector(".jstElements .jsBtnContainer:last-child button"),this.items=Array.from(document.querySelectorAll(".jstElements button")),this.initTabindex()},singleTag:function(t,e){t=t||null,e=e||t,t&&e&&this.encloseSelection(t,e)},encloseSelection:function(t,e,n){var o,s,i,r,l;this.textarea.focus(),t=t||"",e=e||"",void 0!==document.selection?i=document.selection.createRange().text:void 0!==this.textarea.setSelectionRange&&(o=this.textarea.selectionStart,s=this.textarea.selectionEnd,r=this.textarea.scrollTop,i=this.textarea.value.substring(o,s)),i.match(/ $/)&&(i=i.substring(0,i.length-1),e+=" "),l=t+("function"==typeof n?i?n.call(this,i):n(""):i||"")+e,void 0!==document.selection?(document.selection.createRange().text=l,this.textarea.caretPos-=e.length):void 0!==this.textarea.setSelectionRange&&(this.textarea.value=this.textarea.value.substring(0,o)+l+this.textarea.value.substring(s),i?this.textarea.setSelectionRange(o+l.length,o+l.length):this.textarea.setSelectionRange(o+t.length,o+t.length),this.textarea.scrollTop=r)},stripBaseURL:function(t){""!=this.base_url&&(0==t.indexOf(this.base_url)&&(t=t.substr(this.base_url.length)));return t}},jsToolBar.prototype.initTabindex=function(){for(var t=1;t<this.items.length;t++)this.items[t].setAttribute("tabindex","-1");this.items[0].setAttribute("tabindex","0")},jsToolBar.prototype.setFocus=function(t){for(var e=0;e<this.items.length;e++)this.items[e].setAttribute("tabindex","-1");t.setAttribute("tabindex","0"),t.focus()},jsToolBar.prototype.moveFocus=function(t,e){var n;n="previous"==e?t===this.firstItem?this.lastItem:this.items[this.items.indexOf(t)-1]:t===this.lastItem?this.firstItem:this.items[this.items.indexOf(t)+1],this.setFocus(n)},jsToolBar.prototype.hideAllTooltips=function(){Array.from(document.querySelectorAll(".jstElements [role=tooltip]")).forEach(t=>{t.classList.contains("sr-only")||t.classList.add("sr-only")})},jsToolBar.prototype.resizeSetStartH=function(){this.dragStartH=this.textarea.offsetHeight+0},jsToolBar.prototype.resizeDragStart=function(t){var e=this;this.dragStartY=t.clientY,this.resizeSetStartH(),addListener(document,"mousemove",this.dragMoveHdlr=function(t){e.resizeDragMove(t)}),addListener(document,"mouseup",this.dragStopHdlr=function(t){e.resizeDragStop(t)})},jsToolBar.prototype.resizeDragMove=function(t){this.textarea.style.height=this.dragStartH+t.clientY-this.dragStartY+"px"},jsToolBar.prototype.resizeDragStop=function(){removeListener(document,"mousemove",this.dragMoveHdlr),removeListener(document,"mouseup",this.dragStopHdlr)},jsToolBar.prototype.elements.strong={type:"button",title:"Strong emphasis",fn:{wiki:function(){this.singleTag("__")},markdown:function(){this.singleTag("**")}}},jsToolBar.prototype.elements.em={type:"button",title:"Emphasis",fn:{wiki:function(){this.singleTag("''")},markdown:function(){this.singleTag("*")}}},jsToolBar.prototype.elements.ins={type:"button",title:"Inserted",fn:{wiki:function(){this.singleTag("++")},markdown:function(){this.singleTag("<ins>","</ins>")}}},jsToolBar.prototype.elements.del={type:"button",title:"Deleted",fn:{wiki:function(){this.singleTag("--")},markdown:function(){this.singleTag("<del>","</del>")}}},jsToolBar.prototype.elements.quote={type:"button",title:"Inline quote",fn:{wiki:function(){this.singleTag("{{","}}")},markdown:function(){this.singleTag("<q>","</q>")}}},jsToolBar.prototype.elements.code={type:"button",title:"Code",fn:{wiki:function(){this.singleTag("@@")},markdown:function(){this.singleTag("`")}}},jsToolBar.prototype.elements.space1={type:"space"},jsToolBar.prototype.elements.br={type:"button",title:"Line break",fn:{wiki:function(){this.encloseSelection("%%%\n","")},markdown:function(){this.encloseSelection("  \n","")}}},jsToolBar.prototype.elements.space2={type:"space"},jsToolBar.prototype.elements.ul={type:"button",title:"Unordered list",fn:{wiki:function(){this.encloseSelection("","",(function(t){return"* "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n* ")}))},markdown:function(){this.encloseSelection("","",(function(t){return"* "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n* ")}))}}},jsToolBar.prototype.elements.ol={type:"button",title:"Ordered list",fn:{wiki:function(){this.encloseSelection("","",(function(t){return"# "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n# ")}))},markdown:function(){this.encloseSelection("","",(function(t){return"1. "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n1. ")}))}}},jsToolBar.prototype.elements.pre={type:"button",title:"Preformatted",fn:{wiki:function(){this.encloseSelection("","",(function(t){return" "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n ")}))},markdown:function(){this.encloseSelection("\n","",(function(t){return"    "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n    ")}))}}},jsToolBar.prototype.elements.bquote={type:"button",title:"Block quote",fn:{wiki:function(){this.encloseSelection("","",(function(t){return"> "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n> ")}))},markdown:function(){this.encloseSelection("\n","",(function(t){return"> "+(t=t.replace(/\r/g,"")).replace(/\n/g,"\n> ")}))}}},jsToolBar.prototype.elements.space3={type:"space"},jsToolBar.prototype.elements.link={type:"button",title:"Link",fn:{},href_prompt:"Please give page URL:",hreflang_prompt:"Language of this page:",default_hreflang:"",prompt:function(t,e){return t=t||"",e=e||this.elements.link.default_hreflang,!!(t=window.prompt(this.elements.link.href_prompt,t))&&(e=window.prompt(this.elements.link.hreflang_prompt,e),{href:this.stripBaseURL(t),hreflang:e})}},jsToolBar.prototype.elements.link.fn.wiki=function(){var t=this.elements.link.prompt.call(this);if(t){var e="|"+t.href;t.hreflang&&(e=e+"|"+t.hreflang),e+="]",this.encloseSelection("[",e)}},jsToolBar.prototype.elements.link.fn.markdown=function(){var t=this.elements.link.prompt.call(this);if(t){var e="]("+t.href;t.title&&(e+=' "+link.title+"'),e+=")",this.encloseSelection("[",e)}};
